branches:
  only:
    - master

image: ubuntu

environment:
  PROTOC: "${HOME}/protobuf/bin/protoc"
  GRR_VENV: "${HOME}/INSTALL"

install:
- lsb_release -a
- python --version
- echo "${PATH}"
- free -hmw
- lscpu
- sudo apt install -y libmysqlclient-dev
- travis/install_protobuf.sh linux
- virtualenv "${GRR_VENV}"
- ${GRR_VENV}/bin/pip install pytest-xdist
- travis/install.sh

# Appveyor will try to build any Visual Studio projects it finds
# if we do not disable this.
build: off

test_script:
- source "${GRR_VENV}/bin/activate"
- pytest grr/ --ignore grr/server/grr_response_server/gui/selenium_tests/
- (cd grr/server/grr_response_server/gui/static/ && gulp test)
